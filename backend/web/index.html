<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NH Rep Finder (Key Votes)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-md mx-auto p-4 space-y-4">
    <header class="pt-6">
      <h1 class="text-2xl font-semibold">NH Rep Finder</h1>
      <p class="text-sm text-slate-600">Enter your NH address to see your state reps and their key votes.</p>
    </header>

    <form id="form" class="flex gap-2">
      <input id="addr" type="text" placeholder="123 Main St, Town"
             class="flex-1 px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-indigo-500"
             required />
      <button class="px-4 py-2 rounded-lg bg-indigo-600 text-white">Go</button>
    </form>

    <div id="status" class="text-sm text-slate-600"></div>

    <section id="result" class="space-y-3"></section>
  </div>

  <script>
    const form = document.getElementById('form');
    const addr = document.getElementById('addr');
    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultEl.innerHTML = '';
      statusEl.textContent = 'Looking up…';
      try {
        const q = new URLSearchParams({ address: addr.value });
        const r = await fetch(`/lookup?${q.toString()}`);
        const data = await r.json();
        if (!r.ok) {
          statusEl.textContent = data.error || 'Lookup failed.';
          return;
        }
        statusEl.textContent = `Base district: ${data.base_district}` + (data.floterials.length ? ` · Floterials: ${data.floterials.join(', ')}` : '');
        renderReps(data.reps, data.vote_columns);
      } catch (err) {
        statusEl.textContent = 'Error contacting server.';
      }
    });

    function renderReps(reps, voteCols) {
      if (!reps || !reps.length) {
        resultEl.innerHTML = '<p class="text-sm text-slate-600">No reps found.</p>';
        return;
      }
      reps.forEach(rep => {
        const card = document.createElement('div');
        card.className = 'rounded-xl border bg-white p-4 shadow-sm';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between';
        header.innerHTML = `<div>
            <div class="font-medium">${rep.name}</div>
            <div class="text-xs text-slate-500">${rep.party} · ${rep.district}</div>
          </div>`;
        card.appendChild(header);

        // votes grid
        const grid = document.createElement('div');
        grid.className = 'mt-3 grid grid-cols-1 gap-2';
        voteCols.forEach(v => {
          const val = (rep.votes?.[v] || '').trim();
          const badge = document.createElement('div');
          const klass = val.toUpperCase() === 'Y' || val.toUpperCase() === 'YES' ? 'bg-green-100 text-green-700'
                      : val.toUpperCase() === 'N' || val.toUpperCase() === 'NO'  ? 'bg-red-100 text-red-700'
                      : 'bg-slate-100 text-slate-700';
          badge.className = `flex items-center justify-between rounded-lg px-3 py-2 ${klass}`;
          badge.innerHTML = `<span class="text-sm font-medium">${v}</span><span class="text-sm">${val || '—'}</span>`;
          grid.appendChild(badge);
        });
        card.appendChild(grid);

        resultEl.appendChild(card);
      });
    }
  </script>
</body>
</html>
